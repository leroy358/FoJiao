if("undefined"==typeof simple)var simple={};simple.uploader=function(){function b(a){return new c(a)}function c(b){function w(a){i=e(a.url,i),j=e(a.valueBindTo,j),k=e(a.multiple,k,!1),a.limit=e(a.limit,{}),m.fileSizeMin=e(a.limit.fileSizeMin,m.fileSizeMin,0),m.fileSizeMax=e(a.limit.fileSizeMax,m.fileSizeMax,0),m.fileFormat=e(a.limit.fileFormat,m.fileFormat,"*"),a.onEvent=e(a.onEvent,{}),n.onSelectFile=e(a.onEvent.onSelectFile,n.onSelectFile,function(){}),n.onProgress=e(a.onEvent.onProgress,n.onProgress,function(){}),n.onError=e(a.onEvent.onError,n.onError,function(){}),n.onCancelWhenUpload=e(a.onEvent.onCancelWhenUpload,n.onCancelWhenUpload,function(){}),n.onCancelWhenComplete=e(a.onEvent.onCancelWhenComplete,n.onCancelWhenComplete,function(){}),n.onComplete=e(a.onEvent.onComplete,n.onComplete,function(){}),a.uiText=e(a.uiText,{}),o.selectFile=e(a.uiText.selectFile,o.selectFile,d.selectFile),o.limit=e(a.uiText.limit,o.limit,d.limit),o.limit_moreInfo=e(a.uiText.limit_moreInfo,o.limit_moreInfo,d.limit_moreInfo),o.limit_fileSize_main=e(a.uiText.limit_fileSize_main,o.limit_fileSize_main,d.limit_fileSize_main),o.limit_fileSize_min=e(a.uiText.limit_fileSize_min,o.limit_fileSize_min,d.limit_fileSize_min),o.limit_fileSize_max=e(a.uiText.limit_fileSize_max,o.limit_fileSize_max,d.limit_fileSize_max),o.limit_fileSize_fileList=e(a.uiText.limit_fileSize_fileList,o.limit_fileSize_fileList,d.limit_fileSize_fileList),o.limit_fileFormat_main=e(a.uiText.limit_fileFormat_main,o.limit_fileFormat_main,d.limit_fileFormat_main),o.limit_fileFormat_formats=e(a.uiText.limit_fileFormat_formats,o.limit_fileFormat_formats,d.limit_fileFormat_formats),o.limit_fileFormat_fileList=e(a.uiText.limit_fileFormat_fileList,o.limit_fileFormat_fileList,d.limit_fileFormat_fileList),o.error=e(a.uiText.error,o.error,d.error),o.error_moreInfo=e(a.uiText.error_moreInfo,o.error_moreInfo,d.error_moreInfo),o.error_moreInfo_detail=e(a.uiText.error_moreInfo_detail,o.error_moreInfo_detail,d.error_moreInfo_detail),o.complete=e(a.uiText.complete,o.complete,d.complete),o.complete_moreInfo=e(a.uiText.complete_moreInfo,o.complete_moreInfo,d.complete_moreInfo),o.complete_moreInfo_main=e(a.uiText.complete_moreInfo_main,o.complete_moreInfo_main,d.complete_moreInfo_main),o.complete_moreInfo_count=e(a.uiText.complete_moreInfo_count,o.complete_moreInfo_count,d.complete_moreInfo_count),o.complete_moreInfo_fileList=e(a.uiText.complete_moreInfo_fileList,o.complete_moreInfo_fileList,d.complete_moreInfo_fileList),M(q)}function x(){return{appendTo:h,url:i,valueBindTo:j,multiple:k,limit:{fileSizeMin:m.fileSizeMin,fileSizeMax:m.fileSizeMax,fileFormat:m.fileFormat},onEvent:{onSelectFile:n.onSelectFile,onProgress:n.onProgress,onError:n.onError,onCancelWhenUpload:n.onCancelWhenUpload,onCancelWhenComplete:n.onCancelWhenComplete,onComplete:n.onComplete},uiText:{selectFile:o.selectFile,limit:o.limit,limit_moreInfo:o.limit_moreInfo,limit_fileSize_main:o.limit_fileSize_main,limit_fileSize_min:o.limit_fileSize_min,limit_fileSize_max:o.limit_fileSize_max,limit_fileSize_fileList:o.limit_fileSize_fileList,limit_fileFormat_main:o.limit_fileFormat_main,limit_fileFormat_formats:o.limit_fileFormat_formats,limit_fileFormat_fileList:o.limit_fileFormat_fileList,error:o.error,error_moreInfo:o.error_moreInfo,error_moreInfo_detail:o.error_moreInfo_detail,complete:o.complete,complete_moreInfo:o.complete_moreInfo,complete_moreInfo_main:o.complete_moreInfo_main,complete_moreInfo_count:o.complete_moreInfo_count,complete_moreInfo_fileList:o.complete_moreInfo_fileList}}}function y(){return q}function z(){"uploading"==q?(r.abort(),M("selectFile")):"uploadSucceed"==q&&(M("selectFile"),j.value="")}function A(){p["s-uploader-wrapper"]=document.createElement("div"),p["s-uploader-wrapper"].setAttribute("s-uploader-wrapper","");var a='<input type="file" style="display:none;" accept="" s-uploader-inputFile id="s-uploader-inputFile'+c+'"/>'+'<span style="visibility:hidden;" s-uploader-wrapper-selectFile>'+'<label for="s-uploader-inputFile'+c+'" s-uploader-selectFile>'+"<div s-uploader-selectFile-text>\u9009\u62e9\u6587\u4ef6</div>"+"</label>"+"</span>"+'<span style="visibility:hidden;" s-uploader-wrapper-uploadFile>'+"<div s-uploader-progressBarWrapper>"+"<div s-uploader-progressBarInnerWrapper>"+'<div s-uploader-progressBar style="left:-100%;"></div>'+"<div s-uploader-speedInfo>000 KB/s</div>"+"</div>"+"</div>"+"<div s-uploader-cancelUploadButton></div>"+"</span>"+'<span style="visibility:hidden;" s-uploader-wrapper-succeedInfo>'+"<div s-uploader-success>"+"<div s-uploader-successTip>"+"<span s-uploader-successTip-text>\u4e0a\u4f20\u6210\u529f</span>"+"<span s-uploader-successTip-moreInfo>[\u8be6\u60c5]</span>"+"</div>"+"</div>"+"<div s-uploader-cancelSucceedButton></div>"+"</span>"+'<span style="visibility:hidden;" s-uploader-wrapper-FailInfo>'+"<div s-uploader-fail>"+"<div s-uploader-failTip>"+"<span s-uploader-failTip-text>\u4e0a\u4f20\u5931\u8d25</span>"+"<span s-uploader-failTip-moreInfo>[\u8be6\u60c5]</span>"+"</div>"+"</div>"+"<div s-uploader-returnButton></div>"+"</span>";p["s-uploader-wrapper"].innerHTML=a,p["s-uploader-inputFile"]=p["s-uploader-wrapper"].querySelector("[s-uploader-inputFile]"),p["s-uploader-wrapper-selectFile"]=p["s-uploader-wrapper"].querySelector("[s-uploader-wrapper-selectFile]"),p["s-uploader-selectFile-text"]=p["s-uploader-wrapper"].querySelector("[s-uploader-selectFile-text]"),p["s-uploader-wrapper-uploadFile"]=p["s-uploader-wrapper"].querySelector("[s-uploader-wrapper-uploadFile]"),p["s-uploader-progressBar"]=p["s-uploader-wrapper"].querySelector("[s-uploader-progressBar]"),p["s-uploader-speedInfo"]=p["s-uploader-wrapper"].querySelector("[s-uploader-speedInfo]"),p["s-uploader-cancelUploadButton"]=p["s-uploader-wrapper"].querySelector("[s-uploader-cancelUploadButton]"),p["s-uploader-wrapper-succeedInfo"]=p["s-uploader-wrapper"].querySelector("[s-uploader-wrapper-succeedInfo]"),p["s-uploader-successTip-text"]=p["s-uploader-wrapper"].querySelector("[s-uploader-successTip-text]"),p["s-uploader-successTip-moreInfo"]=p["s-uploader-wrapper"].querySelector("[s-uploader-successTip-moreInfo]"),p["s-uploader-cancelSucceedButton"]=p["s-uploader-wrapper"].querySelector("[s-uploader-cancelSucceedButton]"),p["s-uploader-wrapper-FailInfo"]=p["s-uploader-wrapper"].querySelector("[s-uploader-wrapper-FailInfo]"),p["s-uploader-failTip-text"]=p["s-uploader-wrapper"].querySelector("[s-uploader-failTip-text]"),p["s-uploader-failTip-moreInfo"]=p["s-uploader-wrapper"].querySelector("[s-uploader-failTip-moreInfo]"),p["s-uploader-returnButton"]=p["s-uploader-wrapper"].querySelector("[s-uploader-returnButton]"),h.appendChild(p["s-uploader-wrapper"])}function B(){p["s-uploader-successTip-moreInfo"].addEventListener("click",D),p["s-uploader-failTip-moreInfo"].addEventListener("click",D),p["s-uploader-returnButton"].addEventListener("click",E),p["s-uploader-cancelUploadButton"].addEventListener("click",F),p["s-uploader-cancelSucceedButton"].addEventListener("click",G)}function C(){for(var b,c=[],d=[],e=0;e<p["s-uploader-inputFile"].files.length;e++){if(b=p["s-uploader-inputFile"].files[e],"*"!=m.fileFormat){var h=b.name.split("."),j=m.fileFormat.indexOf(h[h.length-1]);(1==h.length||-1==j)&&c.push(e)}(b.size<1024*m.fileSizeMin&&m.fileSizeMin>0||b.size>1024*m.fileSizeMax&&m.fileSizeMax>0)&&d.push(e)}var k=n.onSelectFile(p["s-uploader-inputFile"].files,0==c.length+d.length);0==k?M("selectFile"):0!=c.length+d.length&&1!=k?(t="",c.length>0&&(t+=o.limit_fileFormat_main,t+="\n\n"+o.limit_fileFormat_formats,t+="\n"+m.fileFormat.replace(/\|/g," "),t+="\n\n"+o.limit_fileFormat_fileList,t+=""+function(){for(var a="",b=0;b<c.length;b++)a+="\n- "+p["s-uploader-inputFile"].files[c[b]].name;return a}()+"\n\n"),d.length>0&&(t+=o.limit_fileSize_main+"\n",m.fileSizeMin>0&&(t+="\n"+o.limit_fileSize_min,t+=g(1024*m.fileSizeMin)),m.fileSizeMax>0&&(t+="\n"+o.limit_fileSize_max,t+=g(1024*m.fileSizeMax)),t+="\n\n"+o.limit_fileSize_fileList,t+=""+function(){for(var a="",b=0;b<d.length;b++)a+="\n- "+p["s-uploader-inputFile"].files[d[b]].name,a+=" ("+g(p["s-uploader-inputFile"].files[d[b]].size)+")";return a}()+"\n\n"),M("uploadLimit")):(M("uploading"),p["s-uploader-speedInfo"].innerHTML="0 KB/s",p["s-uploader-progressBar"].style.left="-100%",s=f(p["s-uploader-inputFile"].files),r=new XMLHttpRequest,r.upload.addEventListener("progress",I),u=0,v=0,r.addEventListener("loadstart",H),r.addEventListener("load",L),r.addEventListener("error",J),r.addEventListener("abort",K),r.open("post",i),r.send(s))}function D(){alert(t)}function E(){M("selectFile")}function F(){var b=n.onCancelWhenUpload();0!=b&&(r.abort(),M("selectFile"))}function G(){var b=n.onCancelWhenComplete();0!=b&&(M("selectFile"),j.value="")}function H(){}function I(a){var b,c=(new Date).getTime(),d=100*a.loaded/a.total;p["s-uploader-progressBar"].style.left=d-100+"%",0!=v&&(b=1e3*(a.loaded-u)/(c-v),p["s-uploader-speedInfo"].innerHTML=g(b)+"/s"),u=a.loaded,v=c,n.onProgress(a)}function J(a){M("uploadFail"),t=o.error_moreInfo_detail,n.onError(a)}function K(){}function L(a){var b=n.onComplete(p["s-uploader-inputFile"].files,a.target.responseText);0!=b?(M("uploadSucceed"),t="",t+=o.complete_moreInfo_main,t+="\n\n"+o.complete_moreInfo_count,t+=p["s-uploader-inputFile"].files.length,t+="\n\n"+o.complete_moreInfo_fileList,t+=""+function(){for(var a="",b=0;b<p["s-uploader-inputFile"].files.length;b++)a+="\n- "+p["s-uploader-inputFile"].files[b].name;return a}()+"\n\n",j.value=a.target.responseText):M("selectFile")}function M(a){if("uploadFail"==a)q="uploadFail",p["s-uploader-wrapper-selectFile"].style.visibility="hidden",p["s-uploader-wrapper-uploadFile"].style.visibility="hidden",p["s-uploader-wrapper-succeedInfo"].style.visibility="hidden",p["s-uploader-wrapper-FailInfo"].style.visibility="visible",p["s-uploader-failTip-text"].innerHTML=o.error,p["s-uploader-failTip-moreInfo"].innerHTML=" ["+o.error_moreInfo+"]";else if("uploadLimit"==a)q="uploadLimit",p["s-uploader-wrapper-selectFile"].style.visibility="hidden",p["s-uploader-wrapper-uploadFile"].style.visibility="hidden",p["s-uploader-wrapper-succeedInfo"].style.visibility="hidden",p["s-uploader-wrapper-FailInfo"].style.visibility="visible",p["s-uploader-failTip-text"].innerHTML=o.limit,p["s-uploader-failTip-moreInfo"].innerHTML=" ["+o.limit_moreInfo+"]";else if("uploading"==a)q="uploading",p["s-uploader-wrapper-selectFile"].style.visibility="hidden",p["s-uploader-wrapper-uploadFile"].style.visibility="visible",p["s-uploader-wrapper-succeedInfo"].style.visibility="hidden",p["s-uploader-wrapper-FailInfo"].style.visibility="hidden";else if("uploadSucceed"==a)q="uploadSucceed",p["s-uploader-wrapper-selectFile"].style.visibility="hidden",p["s-uploader-wrapper-uploadFile"].style.visibility="hidden",p["s-uploader-wrapper-succeedInfo"].style.visibility="visible",p["s-uploader-wrapper-FailInfo"].style.visibility="hidden",p["s-uploader-successTip-text"].innerHTML=o.complete,p["s-uploader-successTip-moreInfo"].innerHTML=" ["+o.complete_moreInfo+"]";else if("selectFile"==a){if(q="selectFile",p["s-uploader-wrapper-selectFile"].style.visibility="visible",p["s-uploader-wrapper-uploadFile"].style.visibility="hidden",p["s-uploader-wrapper-succeedInfo"].style.visibility="hidden",p["s-uploader-wrapper-FailInfo"].style.visibility="hidden",p["s-uploader-selectFile-text"].innerHTML=o.selectFile,p["s-uploader-inputFile"].parentNode.removeChild(p["s-uploader-inputFile"]),p["s-uploader-inputFile"]=document.createElement("input"),p["s-uploader-inputFile"].setAttribute("type","file"),p["s-uploader-inputFile"].setAttribute("style","display:none;"),p["s-uploader-inputFile"].setAttribute("s-uploader-inputFile",""),p["s-uploader-inputFile"].setAttribute("id","s-uploader-inputFile"+c),k?p["s-uploader-inputFile"].setAttribute("multiple",""):p["s-uploader-inputFile"].removeAttribute("multiple"),"*"==m.fileFormat)p["s-uploader-inputFile"].setAttribute("accept","");else{for(var b=m.fileFormat.split("|"),d="",e=0;e<b.length;e++)d+=",."+b[e];var d=d.substr(1);p["s-uploader-inputFile"].setAttribute("accept",d)}p["s-uploader-wrapper"].appendChild(p["s-uploader-inputFile"]),p["s-uploader-inputFile"].addEventListener("change",C)}}var c,h,i,j,k,q,r,s,t,u,v,m={},n={},o={},p={};this.getData=x,this.setData=w,this.getState=y,this.cancel=z,c=a++,h=b.appendTo,A(),w(b),B(),M("selectFile")}function e(a,b,c){return"undefined"!=typeof a&&"null"!=typeof a?a:"undefined"!=typeof b&&"null"!=typeof b?b:c}function f(a){for(var b=new FormData,c=0;c<a.length;c++)b.append("file"+c,a[c]);return b}function g(a){var b,c;return a>=1073741824?(b="GB",c=a/1073741824):a>=1048576?(b="MB",c=a/1048576):a>=1024?(b="KB",c=a/1024):(b="B",c=a),c=c.toFixed(1),c+" "+b}var a=0,d={selectFile:"\u9009\u62e9\u6587\u4ef6",limit:"\u6587\u4ef6\u4e0d\u7b26\u5408\u8981\u6c42",limit_moreInfo:"\u8be6\u60c5",limit_fileSize_main:"====================\n\n\u5f53\u524d\u6240\u9009\u6587\u4ef6\u5927\u5c0f\u4e0d\u7b26\u5408\u8981\u6c42",limit_fileSize_min:"\u6587\u4ef6\u6700\u5c0f\uff1a",limit_fileSize_max:"\u6587\u4ef6\u6700\u5927\uff1a",limit_fileSize_fileList:"\u4e0d\u7b26\u5408\u5927\u5c0f\u8981\u6c42\u7684\u6587\u4ef6\u6709\uff1a",limit_fileFormat_main:"====================\n\n\u5f53\u524d\u9009\u62e9\u7684\u6587\u4ef6\u683c\u5f0f\u4e0d\u7b26\u5408\u8981\u6c42",limit_fileFormat_formats:"\u652f\u6301\u7684\u683c\u5f0f\u6709\uff1a",limit_fileFormat_fileList:"\u683c\u5f0f\u7b26\u5408\u8981\u6c42\u7684\u6587\u4ef6\u6709\uff1a",error:"\u4e0a\u4f20\u65f6\u53d1\u751f\u9519\u8bef",error_moreInfo:"\u8be6\u60c5",error_moreInfo_detail:"====================\n\n\u56e0\u7edc\u4e0d\u7a33\u5b9a\u6216\u670d\u52a1\u5668\u672a\u6b63\u5e38\u54cd\u5e94\uff0c\u4e0a\u4f20\u4e2d\u65ad\u3002\n\u8bf7\u68c0\u67e5\u4f60\u7684\u7f51\u7edc\u8fde\u63a5\u548c\u7f51\u901f\u662f\u5426\u7a33\u5b9a\u3002",complete:"\u4e0a\u4f20\u5b8c\u6bd5",complete_moreInfo:"\u8be6\u60c5",complete_moreInfo_main:"====================\n\n\u6587\u4ef6\u4e0a\u4f20\u5b8c\u6bd5",complete_moreInfo_count:"\u4e0a\u4f20\u6587\u4ef6\u6570\u91cf\uff1a",complete_moreInfo_fileList:"\u4e0a\u4f20\u7684\u6587\u4ef6\uff1a"};return{create:b}}();